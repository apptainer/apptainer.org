

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keyserver Management &mdash; Apptainer User Guide main documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=a8da1a53"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/js/ga.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="OCI Image Registries" href="registry.html" />
    <link rel="prev" title="Remote Endpoints" href="endpoint.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Apptainer User Guide
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Apptainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security in Apptainer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_a_container.html">Build a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="definition_files.html">The Definition File</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_env.html">Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="fakeroot.html">Fakeroot feature</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="signNverify.html">Sign and Verify</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_commands.html">Key management commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="encryption.html">Encrypted Containers</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="endpoint.html">Remote Endpoints</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Keyserver Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="registry.html">OCI Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_api.html">Library API Registries</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bind_paths_and_mounts.html">Bind Paths and Mounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistent_overlays.html">Persistent Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_services.html">Instances - Running Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_and_metadata.html">Environment and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="security_options.html">Security Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Network Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cgroups.html">Limiting Container Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">Application Checkpointing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="singularity_compatibility.html">Singularity Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker_and_oci.html">Support for Docker / OCI Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="oci_runtime.html">OCI Runtime Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi.html">Apptainer and MPI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apptainer User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Keyserver Management</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apptainer/apptainer-userdocs/blob/main/keyserver.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="keyserver-management">
<span id="keyserver"></span><h1>Keyserver Management<a class="headerlink" href="#keyserver-management" title="Link to this heading"></a></h1>
<p>By default, Apptainer will use the keyserver defined by the active
<a class="reference internal" href="endpoint.html#endpoint"><span class="std std-ref">remote endpoint</span></a>’s service discovery file. This behavior can be
changed or supplemented using the <code class="docutils literal notranslate"><span class="pre">key</span></code> command and, in particular, its
subcommands <code class="docutils literal notranslate"><span class="pre">add</span></code> and <code class="docutils literal notranslate"><span class="pre">remove</span></code>. These allow an administrator to create a
global list of keyservers that will be used to verify container signatures by
default. When verifying container signatures, Apptainer consults them
according to a configured <em>order</em> (with the keyserver whose order is <code class="docutils literal notranslate"><span class="pre">1</span></code>
consulted first, then the one whose order is <code class="docutils literal notranslate"><span class="pre">2</span></code>, and so forth). Other
operations performed by Apptainer that reach out to a keyserver will only
use the first one (whose order is <code class="docutils literal notranslate"><span class="pre">1</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In previous versions of Apptainer, the functionality described here was
grouped together with <a class="reference internal" href="endpoint.html#endpoint"><span class="std std-ref">remote endpoint management</span></a> under the
<code class="docutils literal notranslate"><span class="pre">remote</span></code> command group. Beginning with version 4.0, this functionality has
been given its own top-level command group, <code class="docutils literal notranslate"><span class="pre">keyserver</span></code>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">list</span></code> subcommand allows the user to examine the set of currently
configured keyservers:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>list

<span class="go">DefaultRemote *^</span>
<span class="gp">#</span><span class="m">1</span><span class="w">  </span>https://keys.openpgp.org<span class="w">  </span>TLS

<span class="gp gp-VirtualEnv">(* = system endpoint, ^ = default endpoint)</span>
</pre></div>
</div>
<p>We can see in the output of the <code class="docutils literal notranslate"><span class="pre">list</span></code> subcommand that “DefaultRemote” is the
<em>default</em> remote endpoint (in other words, the endpoint that will be used by all
Apptainer commands unless otherwise specified), and that it is a <em>global</em>
(in other words, system-level) endpoint. As can be seen above, the output also
indicates that TLS will be used when communicating with the
<code class="docutils literal notranslate"><span class="pre">https://keys.openpgp.org</span></code> keyserver.</p>
<p>We can add a key server to list of keyservers as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>add<span class="w"> </span>https://pgp.example.com
<span class="gp">$ </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>list

<span class="go">DefaultRemote *^</span>
<span class="gp">   #</span><span class="m">1</span><span class="w">  </span>https://keys.openpgp.org<span class="w">   </span>TLS
<span class="gp">   #</span><span class="m">2</span><span class="w">  </span>https://pgp.example.com<span class="w">    </span>TLS

<span class="go">(* = system endpoint, ^ = default endpoint,</span>
<span class="go"> + = user is logged in directly to this keyserver)</span>
</pre></div>
</div>
<p>Here, we see that the <code class="docutils literal notranslate"><span class="pre">https://pgp.example.com</span></code> keyserver was
added to the list. We can specify the order in the list in which this keyserver
should be added, by using the <code class="docutils literal notranslate"><span class="pre">--order</span></code> flag:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>add<span class="w"> </span>--order<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://pgp.example.com
<span class="gp">$ </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>list

<span class="go">DefaultRemote *^</span>
<span class="gp">   #</span><span class="m">1</span><span class="w">  </span>https://pgp.example.com<span class="w">    </span>TLS
<span class="gp">   #</span><span class="m">2</span><span class="w">  </span>https://keys.openpgp.org<span class="w">   </span>TLS

<span class="go">(* = system endpoint, ^ = default endpoint,</span>
<span class="go"> + = user is logged in directly to this keyserver)</span>
</pre></div>
</div>
<p>Since we specified <code class="docutils literal notranslate"><span class="pre">--order</span> <span class="pre">1</span></code>, the <code class="docutils literal notranslate"><span class="pre">https://pgp.example.com</span></code> keyserver was
added as the first entry in the list, and the default keyserver was moved to
second in the list. With this keyserver configuration, all default image
verification performed by Apptainer will, when searching for public keys,
reach out to <code class="docutils literal notranslate"><span class="pre">https://pgp.example.com</span></code> first, and only then to
<code class="docutils literal notranslate"><span class="pre">https://keys.openpgp.org</span></code>.</p>
<p>If a keyserver requires authentication prior to being used, users can login
as follows, supplying the password or an API token at the prompt:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>login<span class="w"> </span>--username<span class="w"> </span>myname<span class="w"> </span>https://pgp.example.com
<span class="go">Password / Token:</span>
<span class="go">INFO:    Token stored in /home/myuser/.apptainer/remote.yaml</span>
</pre></div>
</div>
<p>The output of <cite>keyserver list</cite> will now show that we are logged in to
<code class="docutils literal notranslate"><span class="pre">https://pgp.example.com</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>apptainer<span class="w"> </span>keyserver<span class="w"> </span>list

<span class="go">DefaultRemote *^</span>
<span class="gp">   #</span><span class="m">1</span><span class="w">  </span>https://pgp.example.com<span class="w">       </span>TLS<span class="w">  </span>+
<span class="gp">   #</span><span class="m">2</span><span class="w">  </span>https://keys.openpgp.org<span class="w">      </span>TLS

<span class="go">(* = system endpoint, ^ = default endpoint,</span>
<span class="go"> + = user is logged in directly to this keyserver)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important for users to be aware that the <code class="docutils literal notranslate"><span class="pre">keyserver</span> <span class="pre">login</span></code> command
will store the supplied credentials or tokens unencrypted in their home
directory.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="endpoint.html" class="btn btn-neutral float-left" title="Remote Endpoints" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="registry.html" class="btn btn-neutral float-right" title="OCI Image Registries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <br>
    &copy; Contributors to the Apptainer project, established as Apptainer a Series of LF Projects LLC
    <br>
    &copy; 2017-2022, Sylabs Inc


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>