

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OCI Image Registries &mdash; Apptainer User Guide main documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=a8da1a53"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/js/ga.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Library API Registries" href="library_api.html" />
    <link rel="prev" title="Keyserver Management" href="keyserver.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Apptainer User Guide
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction to Apptainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security in Apptainer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_a_container.html">Build a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="definition_files.html">The Definition File</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_env.html">Build Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="fakeroot.html">Fakeroot feature</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="signNverify.html">Sign and Verify</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_commands.html">Key management commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="encryption.html">Encrypted Containers</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="endpoint.html">Remote Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="keyserver.html">Keyserver Management</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">OCI Registries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-authfile-flag">The <code class="docutils literal notranslate"><span class="pre">--authfile</span></code> flag</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#apptainer-authfile">APPTAINER_AUTHFILE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker-vs-oras"><code class="docutils literal notranslate"><span class="pre">docker://</span></code> vs <code class="docutils literal notranslate"><span class="pre">oras://</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#registry-mirrors">Registry mirrors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="library_api.html">Library API Registries</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bind_paths_and_mounts.html">Bind Paths and Mounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistent_overlays.html">Persistent Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_services.html">Instances - Running Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment_and_metadata.html">Environment and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="security_options.html">Security Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Network Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cgroups.html">Limiting Container Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">Application Checkpointing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="singularity_compatibility.html">Singularity Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker_and_oci.html">Support for Docker / OCI Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="oci_runtime.html">OCI Runtime Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="mpi.html">Apptainer and MPI applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Support</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licenses</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Apptainer User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">OCI Image Registries</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apptainer/apptainer-userdocs/blob/main/registry.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="oci-image-registries">
<span id="registry"></span><h1>OCI Image Registries<a class="headerlink" href="#oci-image-registries" title="Link to this heading"></a></h1>
<p>It is common for users of Apptainer to use <a class="reference external" href="https://opencontainers.org/">OCI</a> registries as sources for their container
images. Some registries require credentials to access certain images or even the
registry itself. One method is to supply credentials for each command or set
environment variables to contain the credentials for a single registry. See
the sections on authentication via <a class="reference internal" href="docker_and_oci.html#sec-docker-login"><span class="std std-ref">Interactive Login</span></a>
and <a class="reference internal" href="docker_and_oci.html#sec-docker-envvars"><span class="std std-ref">Environment Variables</span></a>.</p>
<p>Alternatively, users can supply credentials on a per-registry basis with the <code class="docutils literal notranslate"><span class="pre">registry</span></code> command.</p>
<p>Users can login to an OCI registry with the <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> command by
specifying a <code class="docutils literal notranslate"><span class="pre">docker://</span></code> prefix to the registry hostname:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>apptainer<span class="w"> </span>registry<span class="w"> </span>login<span class="w"> </span>--username<span class="w"> </span>myuser<span class="w"> </span>docker://docker.com
<span class="go">Password / Token:</span>
<span class="go">INFO:    Token stored in /home/myuser/.docker/config.json</span>
<span class="go">INFO:    Token stored in /home/myuser/.apptainer/remote.yaml</span>

<span class="gp">$ </span>apptainer<span class="w"> </span>registry<span class="w"> </span>list

<span class="go">URI                  SECURE?</span>
<span class="go">docker://docker.com  ✓</span>
</pre></div>
</div>
<p>Apptainer will automatically supply the configured credentials when
interacting with DockerHub. The checkmark in the <code class="docutils literal notranslate"><span class="pre">SECURE?</span></code> column indicates
that Apptainer will use TLS when communicating with the registry.</p>
<p>A user can be logged-in to multiple OCI registries at the same time:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>apptainer<span class="w"> </span>registry<span class="w"> </span>login<span class="w"> </span>--username<span class="w"> </span>myuser<span class="w"> </span>docker://registry.example.com
<span class="go">Password / Token:</span>
<span class="go">INFO:    Token stored in /home/myuser/.apptainer/remote.yaml</span>

<span class="gp">$ </span>apptainer<span class="w"> </span>registry<span class="w"> </span>list

<span class="go">URI                            SECURE?</span>
<span class="go">docker://docker.com            ✓</span>
<span class="go">docker://registry.example.com  ✓</span>
</pre></div>
</div>
<p>Apptainer will supply the correct credentials for the registry based on the
hostname used, whenever one of the following commands is used with a
<code class="docutils literal notranslate"><span class="pre">docker://</span></code> or <code class="docutils literal notranslate"><span class="pre">oras://</span></code> URI:</p>
<p><a class="reference external" href="cli/apptainer_pull.html">pull</a>,
<a class="reference external" href="cli/apptainer_push.html">push</a>,
<a class="reference external" href="cli/apptainer_build.html">build</a>,
<a class="reference external" href="cli/apptainer_exec.html">exec</a>,
<a class="reference external" href="cli/apptainer_shell.html">shell</a>,
<a class="reference external" href="cli/apptainer_run.html">run</a>,
<a class="reference external" href="cli/apptainer_instance.html">instance</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important for users to be aware that the <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> command
will store the supplied credentials or tokens unencrypted in their home
directory, or in whatever file has been explicitly specified via the
<code class="docutils literal notranslate"><span class="pre">--authfile</span></code> flag (discussed below).</p>
</div>
<section id="the-authfile-flag">
<span id="sec-authfile"></span><h2>The <code class="docutils literal notranslate"><span class="pre">--authfile</span></code> flag<a class="headerlink" href="#the-authfile-flag" title="Link to this heading"></a></h2>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> and <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">logout</span></code> subcommands store
data in, and remove data from, the default credentials-storage file in the
user’s <code class="docutils literal notranslate"><span class="pre">$HOME/.docker/docker-config.json</span></code>.</p>
<p>However, users might be interested in storing the credentials generated by
<code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> in a different file. Some example use cases:</p>
<ul class="simple">
<li><p>A user wants to generate (and consume) registry credentials as part of a batch
process. More than one of these batch processes may run in parallel, with
potentially different credentials, and we therefore want each of them to store
credentials in a different location.</p></li>
<li><p>One user (or an administrator) wants to create credential files that will then
be transferred to, and consumed by, a different user.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> and <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">logout</span></code> subcommands therefore support an
<code class="docutils literal notranslate"><span class="pre">--authfile</span> <span class="pre">&lt;path&gt;</span></code> flag, which specifies a custom file location for
credential information to be added to (by <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code>) or removed from
(by <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">logout</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apptainer registry login -u myuser --authfile ./myauthfile docker://docker.io
Password / Token:
INFO:    Token stored in ./myauthfile
</pre></div>
</div>
<p>Once credentials have been added to a file, that file can be used in any of the
commands discussed above (<a class="reference external" href="cli/apptainer_pull.html">pull</a>,
<a class="reference external" href="cli/apptainer_push.html">push</a>,
<a class="reference external" href="cli/apptainer_build.html">build</a>,
<a class="reference external" href="cli/apptainer_exec.html">exec</a>,
<a class="reference external" href="cli/apptainer_shell.html">shell</a>,
<a class="reference external" href="cli/apptainer_run.html">run</a>,
<a class="reference external" href="cli/apptainer_instance.html">instance</a>.),
by passing them the same <code class="docutils literal notranslate"><span class="pre">--authfile</span> <span class="pre">&lt;path&gt;</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apptainer shell --authfile myauthfile docker://placeforstuff/private1:latest
INFO:    Converting OCI blobs to SIF format
INFO:    Starting build...
Getting image source signatures
Copying blob 7264a8db6415 done   |
Copying config 913cf3a39d done   |
Writing manifest to image destination
2023/09/28 13:15:46  info unpack layer: sha256:7264a8db6415046d36d16ba98b79778e18accee6ffa71850405994cffa9be7de
INFO:    Creating SIF file...
[=====================================================================]
100 % 0s
Apptainer&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">APPTAINER_DOCKER_{USERNAME,PASSWORD}</span></code> or
<code class="docutils literal notranslate"><span class="pre">DOCKER_{USERNAME,PASSWORD}</span></code> environment variables are set, they will take
precedence over anything specified with the <code class="docutils literal notranslate"><span class="pre">--authfile</span></code> flag (or anything
specified with the <code class="docutils literal notranslate"><span class="pre">APPTAINER_AUTHFILE</span></code> variable, discussed below). See
the <a class="reference internal" href="docker_and_oci.html#sec-docker-envvars"><span class="std std-ref">documentation of docker-related environment variables</span></a> for details.</p>
</div>
<p>Finally, note that logging in when the relevant credentials already exist, and
logging out when the relevant credentials are already absent, are not considered
errors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apptainer registry login -u myuser --authfile ./myauthfile docker://docker.io
Password / Token:
INFO:    Token stored in ./myauthfile
$ apptainer registry login -u myuser --authfile ./myauthfile docker://docker.io
Password / Token:
INFO:    Token stored in ./myauthfile
$ apptainer registry logout --authfile ./myauthfile docker://docker.io
INFO:    Token removed from ./myauthfile
INFO:    Logout succeeded
$ apptainer registry logout --authfile ./myauthfile docker://docker.io
WARNING: There is no existing login to registry &quot;docker.io&quot;.
INFO:    Logout succeeded
</pre></div>
</div>
<section id="apptainer-authfile">
<h3>APPTAINER_AUTHFILE<a class="headerlink" href="#apptainer-authfile" title="Link to this heading"></a></h3>
<p>In lieu of using the <code class="docutils literal notranslate"><span class="pre">--authfile</span></code> command-line flag, the same functionality
may be accessed by setting the <code class="docutils literal notranslate"><span class="pre">APPTAINER_AUTHFILE</span></code> environment variable,
both for the <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">login</span></code> / <code class="docutils literal notranslate"><span class="pre">registry</span> <span class="pre">logout</span></code> commands and for the <a class="reference external" href="cli/apptainer_pull.html">pull</a>,
<a class="reference external" href="cli/apptainer_push.html">push</a>,
<a class="reference external" href="cli/apptainer_build.html">build</a>,
<a class="reference external" href="cli/apptainer_exec.html">exec</a>,
<a class="reference external" href="cli/apptainer_shell.html">shell</a>,
<a class="reference external" href="cli/apptainer_run.html">run</a>,
<a class="reference external" href="cli/apptainer_instance.html">instance</a>.
set of commands.</p>
</section>
</section>
<section id="docker-vs-oras">
<h2><code class="docutils literal notranslate"><span class="pre">docker://</span></code> vs <code class="docutils literal notranslate"><span class="pre">oras://</span></code><a class="headerlink" href="#docker-vs-oras" title="Link to this heading"></a></h2>
<p>Apptainer supports two different protocols when communicating with OCI
registries.
The standard protocol is used with the <code class="docutils literal notranslate"><span class="pre">docker://</span></code> URI.
Apptainer supports pulling OCI containers with that protocol, but it
converts the containers into its own format and does not support pushing
them back to registries using that protocol.
(Pulling can be done explicitly with either the <code class="docutils literal notranslate"><span class="pre">pull</span></code> command or
implicitly by one of the action commands such as <code class="docutils literal notranslate"><span class="pre">run</span></code>.)</p>
<p>On the other hand, the <code class="docutils literal notranslate"><span class="pre">oras://</span></code> protocol is the OCI protocol for
artifacts, so Apptainer supports pushing and pulling <code class="docutils literal notranslate"><span class="pre">.sif</span></code>
containers using that protocol.
The name of the container is in the same format in both cases, with
a registry name, a slash, a tag name (which may itself include a slash),
a colon, and a version.
The default registry name when pulling is <code class="docutils literal notranslate"><span class="pre">docker.io</span></code>.
The same protocol must be used when pulling a container as was used
when pushing it.
The most popular registries are <code class="docutils literal notranslate"><span class="pre">ghcr.io</span></code> and <code class="docutils literal notranslate"><span class="pre">docker.io</span></code> and they
both support both OCI container protocols.</p>
<p>Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apptainer pull docker://alpine:latest
$ apptainer pull docker://ghcr.io/apptainer/apptainer
$ apptainer pull oras://ghcr.io/apptainer/alpine
$ apptainer run docker://alpine
$ apptainer run oras://docker.io/davedykstra/lolcow
</pre></div>
</div>
</section>
<section id="registry-mirrors">
<h2>Registry mirrors<a class="headerlink" href="#registry-mirrors" title="Link to this heading"></a></h2>
<p>Apptainer supports mirrors (caches) for registries.  Please see the
<a class="reference external" href="https://apptainer.org/docs/admin/main/configfiles.html#registry-mirror-configuration">registries.conf section</a>
in the admin guide.
They can be configured system-wide or by individual users.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="keyserver.html" class="btn btn-neutral float-left" title="Keyserver Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="library_api.html" class="btn btn-neutral float-right" title="Library API Registries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <br>
    &copy; Contributors to the Apptainer project, established as Apptainer a Series of LF Projects LLC
    <br>
    &copy; 2017-2022, Sylabs Inc


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>